# CPU训练和测试时间估算 - 基于虚拟环境(.venv37)

## 环境配置

- **虚拟环境**: `.venv37`
- **Python 版本**: 3.7.17
- **PyTorch 版本**: 1.2.0
- **CUDA**: 不可用（CPU模式）
- **CPU**: Intel Core i9-9880H @ 2.30GHz
- **核心数**: 8物理核心 / 16逻辑核心
- **内存**: 16 GB
- **操作系统**: macOS

## 训练数据统计（实际数据）

### 数据集大小
- **train1**: 84 MB (data.mdb: ~88 MB)
- **train2**: 19 MB
- **总数据量**: ~103 MB

### 样本数量（已确认）
- **train1**: 14,573 样本
- **train2**: 2,794 样本
- **总训练样本**: **17,367 样本** ✅

## 训练配置

根据 `config/super_resolution.yaml`:
- **总训练轮数 (epochs)**: 50,000
- **CPU推荐批次大小**: 1
- **验证间隔**: 每1000次迭代
- **保存间隔**: 每200次迭代

## 训练时间估算（基于实际样本数）

### 假设条件

- **训练样本数**: 17,367 (实际数据)
- **批次大小**: 1 (CPU推荐)
- **每个batch处理时间**: 
  - 保守估计: 0.8-1.2秒
  - 优化估计: 0.5-0.8秒 (考虑多核并行)

### 详细计算

#### 每个epoch

**保守估算**:
```
迭代次数 = 17,367 / 1 = 17,367 次
每个batch时间 ≈ 1.0秒 (保守)
每个epoch时间 = 17,367 × 1.0秒 = 17,367秒 ≈ 4.8小时
```

**优化估算**（考虑多核）:
```
每个batch时间 ≈ 0.6秒 (多核优化)
每个epoch时间 = 17,367 × 0.6秒 = 10,420秒 ≈ 2.9小时
```

#### 完整训练 (50,000 epochs)

**保守估算**:
```
总训练时间 = 50,000 × 4.8小时 = 240,000小时
           = 10,000天
           = 约 27.4年
```

**优化估算**:
```
总训练时间 = 50,000 × 2.9小时 = 145,000小时
           = 6,042天
           = 约 16.6年
```

### 实际估算（综合考虑）

考虑到：
- PyTorch 1.2.0 在 CPU 上的性能
- 虚拟环境的轻微性能开销（通常 <5%）
- i9-9880H 的多核性能

**每个epoch时间**: 约 3-4 小时
**完整训练时间**: 约 **17-20年**

## 测试时间估算

### 测试数据集

根据配置，测试集包含：
- `test/easy/`
- `test/medium/`
- `test/hard/`

### 测试时间估算

假设测试集总样本数约 **2,000-3,000** 样本：

```
测试批次大小: 1
每个样本处理时间: 约 0.5-1.0秒
总测试时间 = 2,500 × 0.75秒 ≈ 1,875秒 ≈ 31分钟
```

**测试时间**: 约 **30-60分钟**（取决于测试集大小）

## 实际建议

### ❌ 不推荐：完整训练 (50,000 epochs)

- **时间**: 17-20年
- **结论**: 完全不现实

### ✅ 推荐方案

#### 1. 小规模测试训练 (10 epochs)

**时间估算**:
```
每个epoch: 3-4小时
10 epochs: 30-40小时 ≈ 1.5-2天
```

- **时间**: 约 **1.5-2天**
- **目的**: 验证代码和配置
- **命令**:
  ```bash
  source .venv37/bin/activate
  # 修改配置文件 epochs: 10
  python main.py --batch_size=1 --STN --exp_name test --text_focus --arch tbsrn
  ```

#### 2. 短期训练 (100 epochs)

**时间估算**:
```
100 epochs × 3.5小时 = 350小时 ≈ 14.6天
```

- **时间**: 约 **2周**
- **目的**: 小规模实验
- **适用**: 测试不同超参数

#### 3. 中等训练 (1,000 epochs)

**时间估算**:
```
1,000 epochs × 3.5小时 = 3,500小时 ≈ 146天 ≈ 4.9个月
```

- **时间**: 约 **5个月**
- **目的**: 获得初步模型
- **适用**: 如果必须本地训练

#### 4. 使用预训练模型（最推荐）

- **时间**: 0（直接下载）
- **目的**: 立即使用
- **下载**: [预训练模型链接](https://drive.google.com/file/d/1a-BNCC1pFczz4AkY8sJatg3GpeX1MCCr/view?usp=sharing)

#### 5. 使用云GPU服务

- **Google Colab**: 免费GPU，训练时间约2-3天
- **AWS/Azure**: 付费GPU，训练时间约1-2天
- **成本**: 约 $20-50

## 时间对比表（基于实际样本数）

| 训练规模 | Epochs | 估算时间 | 推荐度 |
|---------|--------|---------|--------|
| **测试训练** | 10 | **1.5-2天** | ⭐⭐⭐⭐⭐ |
| **短期训练** | 100 | **2周** | ⭐⭐⭐⭐ |
| **中等训练** | 1,000 | **5个月** | ⭐⭐ |
| **完整训练** | 50,000 | **17-20年** | ❌ |
| **测试运行** | - | **30-60分钟** | ⭐⭐⭐⭐⭐ |

## Demo 运行时间估算

### 单张图片处理

```
处理时间: 约 2-5秒/张（CPU模式）
包括: 超分辨率 + 文本识别
```

### 批量处理

假设处理 10 张图片：
```
总时间 = 10 × 3秒 = 30秒
```

**Demo 运行**: 非常快，**几秒到几分钟**（取决于图片数量）

## 性能优化建议

### 1. 虚拟环境优化

虚拟环境通常有 <5% 的性能开销，可以忽略。

### 2. 批次大小

```yaml
batch_size: 1  # CPU训练必须使用小批次
```

### 3. Workers 设置

```yaml
workers: 2-4  # 不要超过CPU核心数，避免过度竞争
```

### 4. 减少训练轮数

```yaml
epochs: 100-1000  # 而不是50000
```

### 5. 使用更小的模型

```bash
--arch srcnn  # 而不是 tbsrn（更轻量，可能快20-30%）
```

## 实际运行建议

### 激活虚拟环境

```bash
cd scene-text-telescope
source .venv37/bin/activate
```

### 运行测试训练（推荐先做）

```bash
# 修改 config/super_resolution.yaml 中的 epochs: 10
python main.py --batch_size=1 --STN --exp_name test_10epochs --text_focus --arch tbsrn
```

**预计时间**: 1.5-2天

### 运行测试

```bash
python main.py \
    --batch_size=1 \
    --STN \
    --exp_name test_run \
    --text_focus \
    --resume checkpoint/model_best.pth \
    --test \
    --test_data_dir ./dataset/mydata/test
```

**预计时间**: 30-60分钟

### 运行 Demo

```bash
python demo_example.py --demo_dir ./demo --resume checkpoint/model_best.pth
```

**预计时间**: 几秒到几分钟（取决于图片数量）

## 结论

**在您的Mac (i9-9880H, 16GB RAM) 上使用虚拟环境(.venv37)进行CPU训练**:

### 训练时间
1. **完整训练不现实**: 需要17-20年
2. **测试训练可行**: 1.5-2天可以完成10个epochs
3. **短期训练**: 2周可以完成100个epochs
4. **最佳方案**: 使用预训练模型或云GPU服务

### 测试时间
- **测试运行**: 30-60分钟（完全可行）
- **Demo运行**: 几秒到几分钟（非常快）

### 推荐行动

1. **立即使用**: 下载预训练模型进行测试和demo
2. **小规模测试**: 运行10 epochs验证代码（1.5-2天）
3. **完整训练**: 使用云GPU服务（Google Colab免费，2-3天）

## 注意事项

1. **虚拟环境性能**: `.venv37` 虚拟环境的性能开销很小（<5%），可以忽略
2. **PyTorch 1.2.0**: 这是2019年的版本，在CPU上的性能可能不如新版本
3. **内存使用**: 16GB内存足够，但建议监控内存使用情况
4. **长时间运行**: 如果运行长时间训练，建议使用 `nohup` 或 `screen`/`tmux`

